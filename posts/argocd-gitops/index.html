<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>GitOps in practice | A DevOps Odyssey</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Previously I looked at K3d with ArgoCD and recklessly threw in GitOps without a real explanation&mldr;
What is GitOps and why do I need it? Just another buzzword? I personally don&rsquo;t think so.
To Quote from WeaveWorks:
 GitOps works by using Git as a single source of truth for declarative infrastructure and applications. With GitOps, the use of software agents can alert on any divergence between Git with what&rsquo;s running in a cluster, and if there&rsquo;s a difference, Kubernetes reconcilers automatically update or rollback the cluster depending on the case.">
<meta name=generator content="Hugo 0.87.0">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=../../ananke/css/main.min.css>
<meta property="og:title" content="GitOps in practice">
<meta property="og:description" content="Previously I looked at K3d with ArgoCD and recklessly threw in GitOps without a real explanation&mldr;
What is GitOps and why do I need it? Just another buzzword? I personally don&rsquo;t think so.
To Quote from WeaveWorks:
 GitOps works by using Git as a single source of truth for declarative infrastructure and applications. With GitOps, the use of software agents can alert on any divergence between Git with what&rsquo;s running in a cluster, and if there&rsquo;s a difference, Kubernetes reconcilers automatically update or rollback the cluster depending on the case.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://davidwmcneill.github.io/posts/argocd-gitops/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-08-10T00:00:00+00:00">
<meta property="article:modified_time" content="2021-08-10T00:00:00+00:00">
<meta itemprop=name content="GitOps in practice">
<meta itemprop=description content="Previously I looked at K3d with ArgoCD and recklessly threw in GitOps without a real explanation&mldr;
What is GitOps and why do I need it? Just another buzzword? I personally don&rsquo;t think so.
To Quote from WeaveWorks:
 GitOps works by using Git as a single source of truth for declarative infrastructure and applications. With GitOps, the use of software agents can alert on any divergence between Git with what&rsquo;s running in a cluster, and if there&rsquo;s a difference, Kubernetes reconcilers automatically update or rollback the cluster depending on the case."><meta itemprop=datePublished content="2021-08-10T00:00:00+00:00">
<meta itemprop=dateModified content="2021-08-10T00:00:00+00:00">
<meta itemprop=wordCount content="504">
<meta itemprop=keywords content="gitops,argocd,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="GitOps in practice">
<meta name=twitter:description content="Previously I looked at K3d with ArgoCD and recklessly threw in GitOps without a real explanation&mldr;
What is GitOps and why do I need it? Just another buzzword? I personally don&rsquo;t think so.
To Quote from WeaveWorks:
 GitOps works by using Git as a single source of truth for declarative infrastructure and applications. With GitOps, the use of software agents can alert on any divergence between Git with what&rsquo;s running in a cluster, and if there&rsquo;s a difference, Kubernetes reconcilers automatically update or rollback the cluster depending on the case.">
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-mid-gray>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=../../ class="f3 fw2 hover-white no-underline white-90 dib">
A DevOps Odyssey
</a>
<div class="flex-l items-center">
<ul class="pl0 mr3">
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=../../about/ title="About page">
About
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=../../posts/ title="Posts page">
Posts
</a>
</li>
</ul>
<a href=https://github.com/davidwmcneill target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=https://davidwmcneill.github.io/posts/argocd-gitops/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=https://davidwmcneill.github.io/posts/argocd-gitops/&text=GitOps%20in%20practice" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://davidwmcneill.github.io/posts/argocd-gitops/&title=GitOps%20in%20practice" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">GitOps in practice</h1>
<time class="f6 mv4 dib tracked" datetime=2021-08-10T00:00:00Z>August 10, 2021</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Previously I looked at K3d with ArgoCD and recklessly threw in GitOps without a real explanation&mldr;</p>
<h2 id=what-is-gitops-and-why-do-i-need-it>What is GitOps and why do I need it?</h2>
<p>Just another buzzword? I personally don&rsquo;t think so.<br>
To Quote from <a href=https://www.weave.works/technologies/gitops/>WeaveWorks</a>:</p>
<blockquote>
<p>GitOps works by using Git as a single source of truth for declarative infrastructure and applications. With GitOps, the use of software agents can alert on any divergence between Git with what&rsquo;s running in a cluster, and if there&rsquo;s a difference, Kubernetes reconcilers automatically update or rollback the cluster depending on the case.</p>
</blockquote>
<p>We can take all the good stuff from IaC (Infrastructure as code) and close the loop on ensuring that what is in Git is always the source of truth with continuous monitoring and divergence alignment.</p>
<p>Cant beat the feeling of looking at an ArgoCD dashboard that spans multiple clusters with everything perfectly in synchronization!</p>
<p>This becomes even more powerful when the infrastructure tooling and the application stack itself can all be managed in exactly the same way. No need to access the running system anymore, absolutely everything is done via Git&mldr;.</p>
<ul>
<li>When was &lsquo;x&rsquo; service updated? Check the Git PR</li>
<li>Alerts for increased volume of 5xx errors since 2pm, did anything change? Check Git</li>
<li>What is the diff between v1.45 and v1.46 in the Helm chart for &lsquo;x&rsquo; service? Check ArgoCD (This can prove really useful for external Helm charts)</li>
</ul>
<hr>
<h2 id=application-stack>Application stack</h2>
<p>I&rsquo;m using <a href=https://github.com/davidwmcneill/gitops-playground-apps>this</a> repository for my local experiments with GitOps. The goal of the project:</p>
<ul>
<li>Testing ArgoCD itself for upgrades and template patterns before moving to live platforms</li>
<li>Experimenting with new Kubernetes tools which can easily be removed when resources get low, whilst maintaining a git state allowing for a quick startup again in the future</li>
</ul>
<h3 id=app-of-apps>App of Apps</h3>
<p>By implementing ArgoCD in an declarative setup, there is a concept referred to as <a href=https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#app-of-apps>App of apps</a>
This allows for a top level to bootstrap sub layers of applications.<br>
In a production grade setup this can be really useful for grouping application stacks by teams, functions etc, each with their own project level permissions.<br>
For simplicity in the local stack all apps are currently sitting under a single top level app and project, but it gives an idea for the use case.</p>
<p>This also becomes really useful for generating the parent apps in a Helm template. There is a really nice example and explanation of this <a href=https://github.com/stevesea/argocd-helm-app-of-apps-example>here</a> which I have used as a foundation for the application template.</p>
<h3 id=templates-and-manifests>Templates and Manifests</h3>
<p>ArgoCD supports a range manifest types. Primarily I&rsquo;ve used <a href=https://helm.sh/>Helm</a>. More recently I&rsquo;ve started to use <a href=https://kustomize.io/>Kustomize</a> and might look to incorporate this more in the future.</p>
<hr>
<h2 id=tips-and-tricks>Tips and Tricks</h2>
<p>Through working with ArgoCD I&rsquo;ve come across and number of well thought out features. Some of the most useful being:</p>
<ul>
<li>Pulling the ArgoCD <a href=https://argoproj.github.io/argo-cd/user-guide/ci_automation/#synchronize-the-app-optional>CLI binary</a> directly from the ArgoCD server. This is really useful when using the cli as part of a CICD pipeline. Whenever you upgrade ArgoCD, the cli used elsewhere will always be on the same version</li>
</ul>
<hr>
<h2 id=reference>Reference</h2>
<ul>
<li><a href=https://www.weave.works/technologies/gitops/>https://www.weave.works/technologies/gitops/</a></li>
<li><a href=https://www.weave.works/technologies/gitops-frequently-asked-questions/>https://www.weave.works/technologies/gitops-frequently-asked-questions/</a></li>
</ul>
<ul class=pa0>
<li class=list>
<a href=../../tags/gitops class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">gitops</a>
</li>
<li class=list>
<a href=../../tags/argocd class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">argocd</a>
</li>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">Related</p>
<ul class="pa0 list">
<li class=mb2>
<a href=../../posts/k3d-argocd/>K3d + ArgoCD = Local GitOps</a>
</li>
</ul>
</div>
</aside>
</article>
</main>
<footer class="bg-mid-gray bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://davidwmcneill.github.io/>
&copy; A DevOps Odyssey 2022
</a>
<div>
<a href=https://github.com/davidwmcneill target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a>
</div>
</div>
</footer>
</body>
</html>